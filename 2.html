<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sachin — Urban Company style (Dark)</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#071025" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --uc-blue:#0f6fff;
      --muted:#9aa4b2; /* for descriptions */
      --accent:#ff9800;
      --success:#22c55e;
      --bg:#071025;
      --card:#0d1320;
      --card-2:#0b1624;
      --muted-2:rgba(255,255,255,0.6);
      --border:rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.02);
    }

    *{box-sizing:border-box}
    body{
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: var(--bg);
      color: #fff;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* App container (Urban Company card) */
    .app-shell{
      width:100%;
      max-width:420px;
      margin:18px auto;
      background: linear-gradient(180deg, var(--card), var(--card-2));
      border-radius:14px;
      box-shadow: 0 12px 40px rgba(2,6,23,0.7);
      overflow:hidden;
      min-height:92vh;
      position:relative;
      border: 1px solid var(--border);
    }

    /* App bar */
    .app-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 16px;
      border-bottom:1px solid rgba(255,255,255,0.03);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      position:sticky;
      top:0;
      z-index:40;
      backdrop-filter: blur(6px);
    }
    .app-title{font-weight:700;color:#fff}
    .icon-btn{
      background:none;border:none;font-size:18px;color:var(--muted-2);cursor:pointer;
    }

    /* header */
    .hero{
      padding:18px;
      background: linear-gradient(180deg, rgba(15,111,255,0.06), rgba(255,255,255,0.01));
    }
    .hero h1{font-size:20px;margin-bottom:6px;color:#fff}
    .hero p{margin:0;color:var(--muted-2);font-size:14px}

    .rating-row{display:flex;align-items:center;gap:8px;margin-top:10px}
    .rating .star{color:#ffb74d}
    .free-badge{background:rgba(34,197,94,0.12);color:var(--success);padding:6px 10px;border-radius:12px;font-weight:600;font-size:13px}

    /* service list */
    .section{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.03);background:transparent}
    .section-title{font-weight:700;color:#fff;margin-bottom:6px}
    .service-item{display:flex;gap:12px;align-items:flex-start;padding:12px 6px;border-top:1px solid rgba(255,255,255,0.02)}
    .service-left{
      width:56px;height:56px;border-radius:10px;
      background: rgba(255,255,255,0.03);
      display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px
    }
    .service-body{flex:1}
    .service-name{font-weight:700;color:#fff;font-size:15px}
    .service-desc{color:var(--muted-2);font-size:13px;margin-top:6px}
    .service-meta{color:var(--muted-2);font-size:12px;margin-top:6px}
    .service-actions{display:flex;flex-direction:column;align-items:flex-end;gap:8px}

    .btn-add{
      background: rgba(15,111,255,0.12);
      border: 1px solid rgba(15,111,255,0.18);
      color: #fff;
      padding:8px 10px;border-radius:8px;font-weight:600;cursor:pointer;
      backdrop-filter: blur(4px);
    }
    .btn-add.added{
      background:var(--success);color:#fff;border:none
    }
    .price{font-weight:800;color:#fff}
    .time{font-size:12px;color:var(--muted-2)}

    /* bottom sticky action like Urban Company */
    .bottom-bar{
      position:sticky;bottom:0;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      padding:12px;border-top:1px solid rgba(255,255,255,0.03);
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      backdrop-filter: blur(6px);
    }
    .cta{
      background:var(--uc-blue);color:#fff;padding:12px 16px;border-radius:10px;font-weight:800;border:none;cursor:pointer;
      box-shadow: 0 8px 20px rgba(15,111,255,0.12);
    }
    .cta-secondary{
      background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer;
    }

    /* booking modal (desktop centered & mobile sheet) */
    .modal-wrap{display:none;position:fixed;inset:0;background:rgba(2,6,23,0.7);z-index:120}
    .modal-wrap.show{display:flex;align-items:center;justify-content:center;padding:20px}
    .modal-card{
      background: linear-gradient(180deg, var(--card), var(--card-2));
      width:100%;max-width:520px;border-radius:12px;padding:20px;box-shadow:0 14px 50px rgba(2,6,23,0.6);max-height:90vh;overflow:auto;border:1px solid rgba(255,255,255,0.03)
    }
    .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;color:#fff}

    /* form controls - dark styles */
    .form-control, .form-select {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.04);
      color: #fff;
      padding:10px;
      border-radius:8px;
      box-shadow: none;
    }
    .form-control::placeholder { color: rgba(255,255,255,0.45); }
    .btn.btn-outline-secondary {
      color: #fff;
      border-color: rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
    }

    .form-check { color: var(--muted-2); }
    .form-check-input { width:18px;height:18px; }

    .form-row{display:flex;gap:10px}
    .form-row .form-control{flex:1}

    /* compact reviews */
    .reviews{padding:10px 12px;background:transparent}
    .review-chip{
      background: rgba(255,255,255,0.02);
      border-radius:10px;padding:10px;min-width:120px;
      box-shadow:0 8px 20px rgba(2,6,23,0.4);
      color:var(--muted-2);
    }

    /* small helper overrides for bootstrap badges used above */
    .badge.bg-white { background: rgba(255,255,255,0.06) !important; color: #fff !important; border: 1px solid rgba(255,255,255,0.03); }

    /* floating actions */
    a[title="Call"] { box-shadow: 0 10px 30px rgba(2,6,23,0.6); }
    a[title="WhatsApp"] { box-shadow: 0 10px 30px rgba(2,6,23,0.6); }

    /* responsive */
    @media(min-width:900px){ body{ background: linear-gradient(180deg, #05121f, var(--bg)); } }

    /* keyframes for spinner */
    @keyframes spin{0%{transform:translate(-50%,-50%) rotate(0)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
  </style>
</head>
<body>

  <div class="app-shell" role="application">
    <header class="app-bar">
      <div style="display:flex;align-items:center;gap:10px">
        <button class="icon-btn" id="backBtn" aria-label="Back"><i class="fas fa-arrow-left"></i></button>
        <div style="display:flex;flex-direction:column">
          <span class="app-title">Sachin Deep Cleaning</span>
          <small style="color:var(--muted-2);font-size:12px">Gurgaon • Trusted pros</small>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="icon-btn" id="searchBtn" aria-label="Search"><i class="fas fa-search"></i></button>
        <button class="icon-btn" id="menuBtn" aria-label="Menu"><i class="fas fa-ellipsis-v"></i></button>
      </div>
    </header>

    <main>
      <section class="hero">
        <h1>Full Home Cleaning</h1>
        <p>Deep cleaning, sofa & carpet shampooing, kitchen & appliance care</p>
        <div class="rating-row">
          <div style="display:flex;align-items:center;gap:8px"><span class="badge bg-white text-dark"><i class="fas fa-star star"></i> 4.82</span><small style="color:var(--muted-2)"> (1.2k reviews)</small></div>
          <div class="free-badge">Free First Go</div>
        </div>
      </section>

      <!-- Services: replicate original services but in UC style -->
      <section class="section">
        <div class="section-title">Apartment</div>
        <!-- Only two options shown as requested -->
        <div class="service-item">
          <div class="service-left"><i class="fas fa-broom"></i></div>
          <div class="service-body">
            <div class="service-name">Furnished apartment</div>
            <div class="service-desc">Deep cleaning, dusting & vacuuming of all surfaces. Kitchen, bathrooms & living area.</div>
            <div class="service-meta">Choose size after tapping Add</div>
          </div>
          <div class="service-actions">
            <button class="btn-add" data-name="Furnished apartment" data-furn="Furnished" data-price="0">Add</button>
            <div class="price">Select size</div>
          </div>
        </div>

        <div class="service-item">
          <div class="service-left"><i class="fas fa-house-damage"></i></div>
          <div class="service-body">
            <div class="service-name">Unfurnished apartment</div>
            <div class="service-desc">Dusting, vacuuming & mopping. Bathrooms and kitchen cleaning.</div>
            <div class="service-meta">Choose size after tapping Add</div>
          </div>
          <div class="service-actions">
            <button class="btn-add" data-name="Unfurnished apartment" data-furn="Non-Furnished" data-price="0">Add</button>
            <div class="price">Select size</div>
          </div>
        </div>
      </section>

      <!-- Compact reviews -->
      <section class="reviews" aria-label="Customer reviews">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px"><strong style="color:#fff">Customer Reviews</strong><small style="color:var(--muted-2)">Latest</small></div>
        <div style="display:flex;gap:10px;overflow:auto;padding-bottom:8px">
          <div class="review-chip">"Amazing cleaning"<br><small style="color:var(--muted-2)">— Amit</small></div>
          <div class="review-chip">"Very professional"<br><small style="color:var(--muted-2)">— Priya</small></div>
          <div class="review-chip">"Spotless work"<br><small style="color:var(--muted-2)">— Rohit</small></div>
        </div>
      </section>

    </main>

    <!-- bottom actions -->
    <div class="bottom-bar">
      <div style="display:flex;flex-direction:column">
        <small style="color:var(--muted-2)">Selected</small>
        <strong id="selectedCount">0 services</strong>
      </div>
      <div style="display:flex;gap:8px">
        <button class="cta-secondary" id="viewCart">View</button>
        <button class="cta" id="openBookingBtn">Book Now</button>
      </div>
    </div>
  </div>

  <!-- Booking Modal / sheet -->
  <div id="bookingModal" class="modal-wrap" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <div class="modal-header">
        <strong>Book Services</strong>
        <button class="icon-btn" id="closeModal" aria-label="Close"><i class="fas fa-times"></i></button>
      </div>
      <form id="bookingForm" style="display:grid;gap:10px">
        <input type="text" name="name" class="form-control" placeholder="Your Name" required>
        <input type="tel" name="phone" class="form-control" placeholder="Phone number" required>

        <div style="display:flex;gap:10px">
          <input id="address" name="address" class="form-control" placeholder="Address (optional)">
          <button type="button" id="getLocation" class="btn btn-outline-secondary" title="Use current location">📍</button>
        </div>

        <div style="display:flex;gap:10px">
          <select name="bhk" class="form-select" required>
            <option value="" disabled selected>Select BHK</option>
            <option value="1RK">1RK</option>
            <option value="1BHK">1BHK</option>
            <option value="2BHK">2BHK</option>
            <option value="3BHK">3BHK</option>
            <option value="4BHK">4BHK</option>
            <option value="5BHK">5BHK</option>
          </select>
          <select name="furnished" class="form-select" required>
            <option value="" disabled selected>Furnishing</option>
            <option value="Furnished">Furnished</option>
            <option value="Non-Furnished">Non-Furnished</option>
          </select>
        </div>

        <!-- addons (kept minimal) -->
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <label class="form-check">
            <input class="form-check-input addon" type="checkbox" value="Carpet Cleaning" data-price="500"> Carpet (+₹500)
          </label>
          <label class="form-check">
            <input class="form-check-input addon" type="checkbox" value="Fridge Cleaning" data-price="300"> Fridge (+₹300)
          </label>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
          <div>
            <div style="font-size:13px;color:var(--muted-2)">Estimated total</div>
            <div style="font-weight:800;font-size:18px" id="estimatedPrice">₹0</div>
          </div>
          <div>
            <input type="hidden" name="price">
            <input type="hidden" name="addons">
            <button type="submit" class="cta">Confirm</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Floating actions (call/wa/notify/install) -->
  <a href="tel:+919267905943" title="Call" style="position:fixed;right:18px;bottom:96px;background:var(--uc-blue);width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;z-index:140;box-shadow:0 10px 30px rgba(2,6,23,0.6)"><i class="fas fa-phone"></i></a>
  <a href="https://wa.me/919267905943" target="_blank" title="WhatsApp" style="position:fixed;right:18px;bottom:18px;background:#25d366;width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;z-index:140;box-shadow:0 10px 30px rgba(2,6,23,0.6)"><i class="fab fa-whatsapp"></i></a>

  <button id="installBtn" title="Install" style="position:fixed;left:18px;bottom:96px;background:var(--uc-blue);width:52px;height:52px;border-radius:50%;display:none;align-items:center;justify-content:center;color:#fff;z-index:140;border:none"><i class="fas fa-download"></i></button>
  <button id="notifyBtn" title="Notify" style="position:fixed;left:18px;bottom:18px;background:var(--accent);width:52px;height:52px;border-radius:50%;display:none;align-items:center;justify-content:center;color:#fff;z-index:140;border:none"><i class="fas fa-bell"></i></button>

  <script>
    // load OneSignal dynamically (avoids environments that override document.write)
    (function loadOneSignal(){
      try{
        var s = document.createElement('script');
        s.src = 'https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js';
        s.async = true;
        s.onload = function(){
          try{
            if (!window.OneSignal) return;
            OneSignal.init({
              appId: 'ed4eb090-75aa-4d2c-b321-183eb734f389',
              safari_web_id: 'web.onesignal.auto.477dedc8-8bcf-40fd-b64c-238033111672',
              notifyButton: { enable: true, position: 'bottom-left' },
              serviceWorkerParam: { scope: '/onesignal/' },
              serviceWorkerPath: 'OneSignalSDKWorker.js'
            }).then(function(){
              var btn = document.getElementById('notifyBtn'); if (btn) btn.style.display = 'none';
            }).catch(function(e){ console.warn('OneSignal init error', e); var btn = document.getElementById('notifyBtn'); if (btn) btn.style.display = 'flex'; });
          }catch(e){ console.warn('OneSignal load handler error', e); }
        };
        document.head.appendChild(s);
      }catch(e){ console.warn('Unable to append OneSignal', e); }
    })();

    // pricing map
    var pricing = {
      "1RK": { "Furnished": 2000, "Non-Furnished": 1500 },
      "1BHK": { "Furnished": 2500, "Non-Furnished": 2000 },
      "2BHK": { "Furnished": 4500, "Non-Furnished": 4000 },
      "3BHK": { "Furnished": 5500, "Non-Furnished": 5000 },
      "4BHK": { "Furnished": 7000, "Non-Furnished": 6000 },
      "5BHK": { "Furnished": 10000, "Non-Furnished": 8500 }
    };

    var selected = new Map();
    var modalSelectedService = '';
    var modalOriginButton = null;

    function updateSelectedUI(){
      var count = selected.size;
      var el = document.getElementById('selectedCount'); if (el) el.textContent = count ? (count + ' services') : '0 services';
    }

    document.addEventListener('DOMContentLoaded', function(){
      // wire add buttons: open modal and prefill furnishing
      var addButtons = document.querySelectorAll('.btn-add');
      addButtons.forEach(function(btn){
        btn.addEventListener('click', function(){
          modalSelectedService = btn.getAttribute('data-name') || '';
          modalOriginButton = btn;
          var furn = btn.getAttribute('data-furn') || '';
          var furnEl = document.querySelector('[name="furnished"]');
          if (furnEl && furn) {
            furnEl.value = furn;
          }
          var bhkEl = document.querySelector('[name="bhk"]'); if (bhkEl) bhkEl.value = '';

          var bookingModal = document.getElementById('bookingModal');
          if (bookingModal){ bookingModal.classList.add('show'); bookingModal.setAttribute('aria-hidden','false'); }
          calculateModalTotal();

          setTimeout(function(){ var focusEl = document.querySelector('#bookingForm [name="bhk"]'); if (focusEl) focusEl.focus(); }, 150);
        });
      });

      // open/close modal buttons
      var bookingModal = document.getElementById('bookingModal');
      var openBookingBtn = document.getElementById('openBookingBtn');
      var closeModalBtn = document.getElementById('closeModal');
      if (openBookingBtn) openBookingBtn.addEventListener('click', function(){ if (bookingModal){ bookingModal.classList.add('show'); bookingModal.setAttribute('aria-hidden','false'); } calculateModalTotal(); });
      if (closeModalBtn) closeModalBtn.addEventListener('click', function(){ if (bookingModal){ bookingModal.classList.remove('show'); bookingModal.setAttribute('aria-hidden','true'); } });

      // price calculation
      function pricingFromSelected(){ var sum=0; selected.forEach(function(v){ sum += v; }); return sum; }
      function calculateModalTotal(){
        var total = 0;
        if (selected.size > 0) {
          selected.forEach(function(v){ total += v; });
        } else {
          var bhkEl = document.querySelector('[name="bhk"]');
          var furnEl = document.querySelector('[name="furnished"]');
          var bhk = bhkEl ? bhkEl.value : '';
          var furn = furnEl ? furnEl.value : '';
          if (bhk && furn && pricing[bhk] && typeof pricing[bhk][furn] === 'number') {
            total += pricing[bhk][furn];
          }
        }
        var addons = [];
        var addonChecked = document.querySelectorAll('.addon:checked');
        for (var i=0;i<addonChecked.length;i++){ var a = addonChecked[i]; var p = parseInt(a.getAttribute('data-price'))||0; total += p; addons.push(a.value + ': ₹' + p); }
        var est = document.getElementById('estimatedPrice'); if (est) est.textContent = '₹' + total;
        var priceInput = document.querySelector('[name="price"]'); if (priceInput) priceInput.value = total;
        var addonsInput = document.querySelector('[name="addons"]'); if (addonsInput) addonsInput.value = addons.join(', ');
      }

      var addonEls = document.querySelectorAll('.addon'); for (var i=0;i<addonEls.length;i++){ addonEls[i].addEventListener('change', calculateModalTotal); }
      var bhkSelect = document.querySelector('[name="bhk"]'); if (bhkSelect) bhkSelect.addEventListener('change', calculateModalTotal);
      var furnSelect = document.querySelector('[name="furnished"]'); if (furnSelect) furnSelect.addEventListener('change', calculateModalTotal);

      // geolocation button
      var lat='', lon='', address='';
      var getLocationBtn = document.getElementById('getLocation');
      if (getLocationBtn){
        getLocationBtn.addEventListener('click', function(){
          if (!navigator.geolocation){ alert('Geolocation not supported'); return; }
          var btn = this; btn.disabled = true; btn.textContent = 'Locating…';
          navigator.geolocation.getCurrentPosition(function(pos){
            lat = pos.coords.latitude; lon = pos.coords.longitude;
            fetch('https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=' + lat + '&lon=' + lon, { headers: { 'Accept-Language':'en','User-Agent':'SachinDeepCleaning/1.0' } })
              .then(function(r){ return r.json(); })
              .then(function(data){ if (data && data.display_name){ address = data.display_name; var addrEl = document.getElementById('address'); if (addrEl) addrEl.value = address; } else { throw new Error('no address'); } })
              .catch(function(e){ console.warn('reverse geo failed', e); alert('Unable to resolve address'); })
              .finally(function(){ btn.disabled = false; btn.textContent = '📍'; calculateModalTotal(); });
          }, function(err){ btn.disabled = false; btn.textContent = '📍'; alert('Location failed: ' + (err.message || err.code)); }, { enableHighAccuracy:true, timeout:10000 });
        });
      }

      // booking submit
      var bookingForm = document.getElementById('bookingForm');
      if (bookingForm){
        bookingForm.addEventListener('submit', function(e){
          e.preventDefault(); calculateModalTotal();
          var fd = new FormData(bookingForm); var obj = {};
          fd.forEach(function(v,k){ obj[k]=v; });
          obj.services = modalSelectedService ? modalSelectedService : Array.from(selected.keys()).join(', ');
          obj.latitude = lat || '';
          obj.longitude = lon || '';

          var spinner = document.createElement('div'); spinner.style.cssText='position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:48px;height:48px;border-radius:50%;border:6px solid rgba(255,255,255,0.06);border-top:6px solid var(--uc-blue);animation:spin 1s linear infinite;z-index:200'; document.body.appendChild(spinner);

          fetch('https://script.google.com/macros/s/AKfycbxCl4QKzA7cytjsylc821h0DZIATSp4FGD2JQVNDzdOwRK1y8VpvSoxg3Z5g52qp7uA/exec', { method:'POST', headers:{ 'Content-Type':'application/x-www-form-urlencoded' }, body: new URLSearchParams(obj) })
            .then(function(resp){ return resp.text().then(function(text){ return { ok: resp.ok, text: text }; }); })
            .then(function(result){
              if (result.ok && result.text.trim() === 'Success'){
                alert('Booking submitted — we will contact you');
                bookingForm.reset();
                var priceVal = parseInt(obj.price) || parseInt((document.querySelector('[name="price"]')||{value:0}).value) || 0;
                if (modalSelectedService){
                  selected.set(modalSelectedService, priceVal);
                  if (modalOriginButton){ modalOriginButton.classList.add('added'); modalOriginButton.textContent = 'Added'; }
                }
                updateSelectedUI();
                if (bookingModal){ bookingModal.classList.remove('show'); bookingModal.setAttribute('aria-hidden','true'); }
              } else {
                alert('Submission failed — try again');
                console.error('resp', result.text);
              }
            })
            .catch(function(err){ alert('Error: '+err.message); console.error(err); })
            .finally(function(){ if (spinner && spinner.parentNode) spinner.parentNode.removeChild(spinner); });
        });
      }

      // keyboard escape to close
      document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && bookingModal && bookingModal.classList.contains('show')) bookingModal.classList.remove('show'); });

      // install prompt helper
      var deferredPrompt; var installBtn = document.getElementById('installBtn');
      window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); deferredPrompt = e; if (installBtn) installBtn.style.display = 'flex'; });
      if (installBtn) installBtn.addEventListener('click', function(){ if (!deferredPrompt) return; deferredPrompt.prompt(); deferredPrompt = null; installBtn.style.display = 'none'; });

    }); // end DOMContentLoaded
  </script>
</body>
</html>

