<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sachin Deep Cleaning</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007bff" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- OneSignal SDK (page build) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" async></script>

  <style>
    body { font-family: Arial, sans-serif; }
    .hero {
      background: url('https://aonedeepcleaning.in/assets/img/cleaning/slide3.jpg') no-repeat center center;
      background-size: cover;
      color: white;
      padding: 100px 0;
      text-align: center;
    }
    .services .card { transition: 0.3s ease; }
    .services .card:hover { transform: scale(1.05); }
    footer { background: #222; color: #aaa; padding: 20px 0; text-align: center; }

    /* Floating buttons */
    .floating-button {
      position: fixed;
      z-index: 1100;
      width: 50px;
      height: 50px;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-decoration: none;
    }
    .call-button { right: 20px; bottom: 140px; background-color: #007bff; }
    .whatsapp-button { right: 20px; bottom: 80px; background-color: #25d366; }
    #installBtn { position: fixed; left: 20px; bottom: 140px; background-color: #007bff; border: none; border-radius: 50%; width: 50px; height: 50px; color: white; font-size: 24px; display: none; align-items: center; justify-content: center; z-index: 1100; }
    .notification-button { position: fixed; left: 20px; bottom: 80px; background-color: #ff9800; border: none; border-radius: 50%; width: 50px; height: 50px; color: white; font-size: 22px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 1100; }

    /* Spinner */
    #spinner { display: none; margin: 20px auto; border: 6px solid #f3f3f3; border-top: 6px solid #007bff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Reviews */
    #reviews { background: #f8f9fa; padding: 60px 15px; text-align: center; }
    #reviews h2 { margin-bottom: 40px; font-weight: 700; color: #007bff; }
    .review-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: left; }
    .review-header img { display: none !important; } /* keep layout but hide avatars */
    .star-rating { color: #f8ce0b; font-size: 1.2rem; text-align: center; }
    @media(max-width:768px){ .review-card { margin-bottom: 1rem; } }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">Sachin Deep Cleaning</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="#booking">Booking</a></li>
          <li class="nav-item"><a class="nav-link" href="#reviews">Reviews</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <section class="hero">
    <div class="container">
      <h1>Residential & Commercial Cleaning Services</h1>
      <p>Serving Gurgaon with Professional Cleaning Solutions</p>
      <a href="#booking" class="btn btn-primary mt-3">Book Now</a>
    </div>
  </section>

  <!-- Services (omitted for brevity, keep your cards here) -->
  <section class="py-5 bg-light" id="booking">
    <div class="container">
      <div class="text-center mb-4"><h2>Book a Cleaning Service</h2><p>Fill out the form below to schedule a cleaning</p></div>
      <form id="bookingForm" class="row g-3">
        <div class="col-md-6"><input type="text" name="name" class="form-control" placeholder="Your Name" required></div>
        <div class="col-md-6"><input type="tel" name="phone" class="form-control" placeholder="Your Phone Number" required></div>
        <div class="col-md-6">
          <select name="bhk" class="form-select" required>
            <option value="" disabled selected>Select BHK Type</option>
            <option value="1RK">1RK</option><option value="1BHK">1BHK</option><option value="2BHK">2BHK</option>
            <option value="3BHK">3BHK</option><option value="4BHK">4BHK</option><option value="5BHK">5BHK</option>
          </select>
        </div>
        <div class="col-md-6">
          <select name="furnished" class="form-select" required>
            <option value="" disabled selected>Furnishing</option>
            <option value="Furnished">Furnished</option><option value="Non-Furnished">Non-Furnished</option>
          </select>
        </div>

        <div class="col-12">
          <label class="form-label">Add-on Services (optional)</label><br>
          <div class="form-check form-check-inline">
            <input class="form-check-input addon" type="checkbox" value="Carpet Cleaning" data-price="500">
            <label class="form-check-label">Carpet Cleaning (+₹500)</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input addon" type="checkbox" value="Fridge Cleaning" data-price="300">
            <label class="form-check-label">Fridge Cleaning (+₹300)</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input addon" type="checkbox" value="Balcony Cleaning" data-price="400">
            <label class="form-check-label">Balcony Cleaning (+₹400)</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input addon" type="checkbox" value="Pest Control" data-price="600">
            <label class="form-check-label">Pest Control (+₹600)</label>
          </div>
        </div>

        <div class="col-12"><h5>Estimated Price: ₹<span id="estimatedPrice">0</span></h5></div>

        <input type="hidden" name="price">
        <input type="hidden" name="addons">
        <input type="hidden" name="payment" value="Pay After Work">

        <div class="col-12 text-center"><button type="submit" class="btn btn-primary">Submit Booking</button></div>
      </form>

      <div id="spinner"></div>
    </div>
  </section>

  <!-- Reviews -->
  <section id="reviews">
    <div class="container">
      <h2>Customer Reviews</h2>
      <div id="reviewSlider" class="row g-3"></div>
    </div>
  </section>

  <footer><div class="container"><p>&copy; 2025 Sachin Deep Cleaning. All rights reserved.</p></div></footer>

  <!-- Floating buttons (fixed markup) -->
  <a href="tel:+919267905943" class="floating-button call-button" title="Call Now"><i class="fas fa-phone-alt"></i></a>
  <a href="https://wa.me/919267905943?text=Hello%2C%20I%20am%20interested%20in%20Sachin%20Deep%20Cleaning%20Services." class="floating-button whatsapp-button" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>

  <button id="installBtn" title="Download App"><i class="fas fa-download"></i></button>
  <button class="notification-button" id="notifyBtn" title="Enable Notifications"><i class="fas fa-bell"></i></button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // Pricing and calculateTotal (single definition)
  const pricing = {
    "1RK": { "Furnished": 2000, "Non-Furnished": 1500 },
    "1BHK": { "Furnished": 2500, "Non-Furnished": 2000 },
    "2BHK": { "Furnished": 4500, "Non-Furnished": 4000 },
    "3BHK": { "Furnished": 5500, "Non-Furnished": 5000 },
    "4BHK": { "Furnished": 7000, "Non-Furnished": 6000 },
    "5BHK": { "Furnished": 10000, "Non-Furnished": 8500 }
  };

  function calculateTotal() {
    const bhkEl = document.querySelector('[name="bhk"]');
    const furnishedEl = document.querySelector('[name="furnished"]');
    if (!bhkEl || !furnishedEl) return;
    const bhk = bhkEl.value;
    const furnished = furnishedEl.value;
    let total = pricing[bhk]?.[furnished] || 0;
    const addonsDetails = [];
    document.querySelectorAll('.addon:checked').forEach(addon => {
      const price = parseInt(addon.dataset.price || 0, 10);
      total += price;
      addonsDetails.push(`${addon.value}: ₹${price}`);
    });
    document.getElementById("estimatedPrice").innerText = total;
    document.querySelector('[name="price"]').value = total;
    document.querySelector('[name="addons"]').value = addonsDetails.join(", ");
  }

  // Reviews data & rendering
  const reviewsData = [
    {name:"Amit Sharma",gender:"male",location:"South City 1",text:"Amazing cleaning service. Highly recommended!"},
    {name:"Priya Verma",gender:"female",location:"Sushant Lok",text:"Very professional and punctual team."},
    /* ... add the rest or keep as earlier ... */
    {name:"Ankit Mehta",gender:"male",location:"Sector 29",text:"Trustworthy and efficient."}
  ];

  function getAvatarUrl(name, gender){
    const seed = encodeURIComponent(name);
    if (gender === 'female') return `https://api.dicebear.com/6.x/avataaars/svg?seed=${seed}&hair[]=long&mouth[]=smile&eyes[]=happy&skin[]=brown&accessories[]=earrings`;
    return `https://api.dicebear.com/6.x/avataaars/svg?seed=${seed}&hair[]=short&mouth[]=smile&eyes[]=happy&skin[]=brown`;
  }

  function createStarRatingHTML(){ return '<i class="fas fa-star"></i>'.repeat(5); }

  function createReviewCard(review){
    return `
      <div class="col-md-4 mb-4">
        <div class="review-card p-3 border rounded shadow-sm bg-white">
          <div class="review-header d-flex align-items-center mb-3">
            <img src="${getAvatarUrl(review.name, review.gender)}" alt="${review.name}" class="rounded-circle me-3" width="60" height="60">
            <div>
              <p class="reviewer-name mb-0 fw-bold">${review.name}</p>
              <small class="reviewer-location text-muted">${review.location}</small>
            </div>
          </div>
          <p class="review-text fst-italic">"${review.text}"</p>
          <div class="star-rating text-warning">${createStarRatingHTML()}</div>
        </div>
      </div>
    `;
  }

  let currentIndex = 0;
  const reviewsPerSlide = 3;
  function renderReviews(){
    const container = document.getElementById('reviewSlider');
    container.innerHTML = '';
    for (let i=0;i<reviewsPerSlide;i++){
      const idx = (currentIndex + i) % reviewsData.length;
      container.innerHTML += createReviewCard(reviewsData[idx]);
    }
  }
  function slideReviews(){ currentIndex = (currentIndex + reviewsPerSlide) % reviewsData.length; renderReviews(); }

  // Booking form submission
  document.addEventListener('DOMContentLoaded', function(){
    // init pricing UI
    calculateTotal();
    const bhkEl = document.querySelector('[name="bhk"]');
    const furnishedEl = document.querySelector('[name="furnished"]');
    if (bhkEl) bhkEl.addEventListener('change', calculateTotal);
    if (furnishedEl) furnishedEl.addEventListener('change', calculateTotal);
    document.querySelectorAll('.addon').forEach(el => el.addEventListener('change', calculateTotal));

    // render reviews
    renderReviews();
    setInterval(slideReviews, 3000);

    // booking form submit
    const bookingForm = document.getElementById('bookingForm');
    bookingForm && bookingForm.addEventListener('submit', async function(e){
      e.preventDefault();
      const spinner = document.getElementById('spinner');
      spinner.style.display = 'block';
      const data = Object.fromEntries(new FormData(bookingForm).entries());
      try {
        const res = await fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(data).toString()
        });
        const text = await res.text();
        if (res.ok && text.trim() === "Success") {
          alert("Booking submitted successfully! Thank you.");
          bookingForm.reset();
          calculateTotal();
        } else {
          alert("Failed to submit booking. Please try again.");
          console.error("Booking response:", text);
        }
      } catch (err){
        alert("Error submitting booking: " + (err.message || err));
        console.error(err);
      } finally {
        spinner.style.display = 'none';
      }
    });
  });
  </script>

  <!-- PWA install and Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.error('Service Worker registration failed:', err));
      });
    }

    // beforeinstallprompt handling
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'flex';
    });
    installBtn && installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      if (choice.outcome === 'accepted') console.log('User accepted the app install');
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });
  </script>

  <!-- OneSignal init + notification button -->
  <script>
    // Wait for OneSignal SDK to load, then init and wire notify button.
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
      OneSignal.init({
        appId: "ed4eb090-75aa-4d2c-b321-183eb734f389",
        safari_web_id: "web.onesignal.auto.477dedc8-8bcf-40fd-b64c-238033111672",
        notifyButton: { enable: false } // we use custom button
      });

      const notifyBtn = document.getElementById('notifyBtn');
      if (!notifyBtn) return;

      notifyBtn.addEventListener('click', async function () {
        try {
          const supported = await OneSignal.isPushNotificationsSupported();
          if (!supported) {
            alert('Push notifications are not supported by this browser.');
            return;
          }

          // Get current permission: 'default' | 'granted' | 'denied'
          const permission = await OneSignal.getNotificationPermission();
          console.log('Notification permission:', permission);

          if (permission === 'granted') {
            alert("You're already subscribed to notifications!");
            return;
          }

          // Try slidedown prompt; fallback to native prompt if needed
          if (OneSignal.Slidedown && OneSignal.Slidedown.promptPush) {
            OneSignal.Slidedown.promptPush();
          } else if (OneSignal.showNativePrompt) {
            OneSignal.showNativePrompt();
          } else {
            // fallback
            OneSignal.registerForPushNotifications && OneSignal.registerForPushNotifications();
          }
        } catch (err) {
          console.error('Notification prompt error:', err);
          alert('Unable to ask for notifications. See console for details.');
        }
      });
    });
  </script>
</body>
</html>
