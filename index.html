<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sachin Deep Cleaning</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007bff" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- OneSignal Push Notification Integration START -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "ed4eb090-75aa-4d2c-b321-183eb734f389",
        safari_web_id: "web.onesignal.auto.477dedc8-8bcf-40fd-b64c-238033111672",
        notifyButton: {
          enable: true,
          offset: {
            bottom: '20px',
            right: '20px'
          }
        },
      });
    });
  </script>
  <!-- OneSignal Push Notification Integration END -->

  <style>
    body { font-family: Arial, sans-serif; }
    .hero {
      background: url('https://aonedeepcleaning.in/assets/img/cleaning/slide3.jpg') no-repeat center center;
      background-size: cover;
      color: white;
      padding: 100px 0;
      text-align: center;
    }
    .services .card { transition: 0.3s ease; }
    .services .card:hover { transform: scale(1.05); }
    footer { background: #222; color: #aaa; padding: 20px 0; text-align: center; }
    .floating-button {
      position: fixed;
      bottom: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-decoration: none;
    }
    .call-button { left: 20px; background-color: #007bff; }
    .whatsapp-button { right: 20px; bottom: 110px; background-color: #25d366; }

    /* Spinner Styling */
    #spinner {
      display: none;
      margin: 20px auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #007bff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 3D viewer styles (embedded into Our Services) */
    .service-3d {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border-radius: 8px;
      padding: 12px;
      height: 520px;
      position: relative;
      overflow: hidden;
    }
    #sprayModelCanvas { width: 100%; height: 100%; display: block; }
    .three-hint {
      position: absolute;
      right: 12px;
      bottom: 12px;
      z-index: 20;
      background: rgba(0,0,0,0.45);
      color: #dbe7ff;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 13px;
      backdrop-filter: blur(4px);
    }
    /* small responsiveness */
    @media (max-width: 992px) {
      .service-3d { height: 360px; }
      canvas { height: 360px !important; }
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <div class="container">
    <a class="navbar-brand" href="#">Sachin Deep Cleaning</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="hero">
  <div class="container">
    <h1>Residential & Commercial Cleaning Services</h1>
    <p>Serving Gurgaon with Professional Cleaning Solutions</p>
    <a href="#booking" class="btn btn-primary mt-3">Book Now</a>
  </div>
</section>

<!-- Our Services: left = text cards, right = 3D viewer -->
<section class="services py-5" id="services">
  <div class="container">
    <div class="row g-4 align-items-start">
      <div class="col-lg-6">
        <div class="text-center mb-4">
          <h2>Our Services</h2>
          <p>We offer residential & commercial cleaning, carpet cleaning, pest control and more.</p>
        </div>

        <!-- Example service cards (keep your original content; added a few) -->
        <div class="row gy-3">
          <div class="col-md-6">
            <div class="card p-3">
              <h5>Home Deep Cleaning</h5>
              <p class="mb-0">Full home cleaning, sanitization & disinfection.</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card p-3">
              <h5>Commercial Cleaning</h5>
              <p class="mb-0">Office and shop cleaning with professional team.</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card p-3">
              <h5>Carpet & Sofa</h5>
              <p class="mb-0">Steam cleaning and stain removal.</p>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card p-3">
              <h5>Pest Control</h5>
              <p class="mb-0">Safe and certified pest control services.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 3D viewer embedded here -->
      <div class="col-lg-6">
        <div class="service-3d">
          <canvas id="sprayModelCanvas" aria-label="3D spray bottle viewer"></canvas>
          <div class="three-hint">Drag to rotate • Click to spray</div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-5 bg-light" id="booking">
  <div class="container">
    <div class="text-center mb-4">
      <h2>Book a Cleaning Service</h2>
      <p>Fill out the form below to schedule a cleaning</p>
    </div>
    <form id="bookingForm" class="row g-3">
      <div class="col-md-6">
        <input type="text" name="name" class="form-control" placeholder="Your Name" required>
      </div>
      <div class="col-md-6">
        <input type="tel" name="phone" class="form-control" placeholder="Your Phone Number" required>
      </div>
      <div class="col-md-6">
        <select name="bhk" class="form-select" required>
          <option value="" disabled selected>Select BHK Type</option>
          <option value="1RK">1RK</option>
          <option value="1BHK">1BHK</option>
          <option value="2BHK">2BHK</option>
          <option value="3BHK">3BHK</option>
          <option value="4BHK">4BHK</option>
          <option value="5BHK">5BHK</option>
        </select>
      </div>
      <div class="col-md-6">
        <select name="furnished" class="form-select" required>
          <option value="" disabled selected>Furnishing</option>
          <option value="Furnished">Furnished</option>
          <option value="Non-Furnished">Non-Furnished</option>
        </select>
      </div>

      <!-- Add-ons -->
      <div class="col-12">
        <label class="form-label">Add-on Services (optional)</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Carpet Cleaning" data-price="500">
          <label class="form-check-label">Carpet Cleaning (+₹500)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Fridge Cleaning" data-price="300">
          <label class="form-check-label">Fridge Cleaning (+₹300)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Balcony Cleaning" data-price="400">
          <label class="form-check-label">Balcony Cleaning (+₹400)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Pest Control" data-price="600">
          <label class="form-check-label">Pest Control (+₹600)</label>
        </div>
      </div>

      <!-- Display Price -->
      <div class="col-12">
        <h5>Estimated Price: ₹<span id="estimatedPrice">0</span></h5>
      </div>

      <input type="hidden" name="price">
      <input type="hidden" name="addons">
      <input type="hidden" name="payment" value="Pay After Work">

      <div class="col-12 text-center">
        <button type="submit" class="btn btn-primary">Submit Booking</button>
      </div>
    </form>

    <!-- Spinner element -->
    <div id="spinner" style="display:none;"></div>
  </div>
</section>

<footer>
  <div class="container">
    <p>&copy; 2025 Sachin Deep Cleaning. All rights reserved.</p>
  </div>
</footer>

<a href="tel:+919267905943" class="floating-button call-button" title="Call Now">
  <i class="fas fa-phone-alt"></i>
</a>
<a href="https://wa.me/919267905943" class="floating-button whatsapp-button" title="Chat on WhatsApp" target="_blank">
  <i class="fab fa-whatsapp"></i>
</a>

<!-- Bootstrap bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Three.js + extras from CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* -----------------------
   Realistic mist particle system + GLB loader
   - Make sure spray-bottle.glb is in same folder as index.html
   - If performance is slow on phones, reduce MAX_PARTICLES
   ------------------------*/
(function () {
  const canvas = document.getElementById('sprayModelCanvas');
  // Renderer
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);

  // create scene & camera
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x071018);

  const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
  camera.position.set(0, 1.2, 2.6);

  // Resize helper
  function resizeRendererToDisplaySize() {
    const parent = canvas.parentElement;
    const width = parent.clientWidth;
    const height = parent.clientHeight;
    if (canvas.width !== width || canvas.height !== height) {
      renderer.setSize(width, height, false);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    }
  }

  // Lights
  const hemi = new THREE.HemisphereLight(0xffffff, 0x111122, 0.9);
  scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 0.9);
  dir.position.set(3, 4, 2);
  scene.add(dir);

  // Ground plane
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(20, 20),
    new THREE.MeshStandardMaterial({ color: 0x061018, roughness: 0.95 })
  );
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = -1.2;
  scene.add(ground);

  // Controls
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.12;
  controls.minDistance = 1;
  controls.maxDistance = 6;
  controls.target.set(0, 0.8, 0);

  // container for model
  const modelGroup = new THREE.Group();
  scene.add(modelGroup);

  // Particle texture (soft round) generated on the fly
  function makeParticleTexture() {
    const size = 64;
    const tx = document.createElement('canvas');
    tx.width = tx.height = size;
    const ctx = tx.getContext('2d');
    const g = ctx.createRadialGradient(size/2, size/2, 2, size/2, size/2, size/2);
    g.addColorStop(0, 'rgba(255,255,255,1)');
    g.addColorStop(0.2, 'rgba(255,255,255,0.9)');
    g.addColorStop(0.55, 'rgba(180,200,255,0.35)');
    g.addColorStop(1, 'rgba(180,200,255,0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,size,size);
    const t = new THREE.CanvasTexture(tx);
    t.minFilter = THREE.LinearFilter;
    t.needsUpdate = true;
    return t;
  }
  const particleTexture = makeParticleTexture();

  // Particle pool + geometry
  const MAX_PARTICLES = 500; // reduce if slow on mobile
  const particles = new Float32Array(MAX_PARTICLES * 3);
  const velocities = new Float32Array(MAX_PARTICLES * 3);
  const ages = new Float32Array(MAX_PARTICLES);
  const lifetimes = new Float32Array(MAX_PARTICLES);
  const opacities = new Float32Array(MAX_PARTICLES);
  let particleCount = 0;

  const particleGeom = new THREE.BufferGeometry();
  particleGeom.setAttribute('position', new THREE.BufferAttribute(particles, 3));
  particleGeom.setAttribute('aOpacity', new THREE.BufferAttribute(opacities, 1));
  particleGeom.setDrawRange(0, 0);

  const particleMat = new THREE.PointsMaterial({
    size: 0.06,
    map: particleTexture,
    transparent: true,
    depthWrite: false,
    blending: THREE.AdditiveBlending,
    sizeAttenuation: true,
    opacity: 1
  });

  const particlePoints = new THREE.Points(particleGeom, particleMat);
  particlePoints.frustumCulled = false;
  scene.add(particlePoints);

  // Helper to spawn N particles in a cone
  function emitMist(origin, direction, amount = 60) {
    // direction should be normalized
    for (let i = 0; i < amount; i++) {
      if (particleCount >= MAX_PARTICLES) {
        // recycle oldest
        let oldest = 0;
        let maxAge = -1;
        for (let j = 0; j < MAX_PARTICLES; j++) {
          if (ages[j] > maxAge) { maxAge = ages[j]; oldest = j; }
        }
        spawnAt(oldest, origin, direction);
      } else {
        spawnAt(particleCount, origin, direction);
        particleCount++;
      }
    }
    particleGeom.setDrawRange(0, particleCount);
  }

  function spawnAt(i, origin, direction) {
    // spread cone
    const spread = 0.28; // cone spread
    // random spherical jitter
    const jitter = new THREE.Vector3(
      (Math.random() - 0.5) * spread,
      (Math.random() - 0.1) * spread,
      (Math.random() - 0.5) * spread
    );
    const dir = new THREE.Vector3().copy(direction).add(jitter).normalize();
    const speed = 1.2 + Math.random() * 0.8; // spray speed
    velocities[i*3+0] = dir.x * speed;
    velocities[i*3+1] = dir.y * speed + (Math.random()*0.2);
    velocities[i*3+2] = dir.z * speed;

    // starting position slightly forward of origin
    const start = origin.clone().add(dir.clone().multiplyScalar(0.08)).add(new THREE.Vector3(
      (Math.random()-0.5)*0.02, (Math.random()-0.3)*0.02, (Math.random()-0.5)*0.02
    ));
    particles[i*3+0] = start.x;
    particles[i*3+1] = start.y;
    particles[i*3+2] = start.z;

    ages[i] = 0;
    lifetimes[i] = 800 + Math.random() * 900; // ms
    opacities[i] = 1;
  }

  // Update particles each frame
  function updateParticles(dt) {
    const gravity = -0.0012;
    for (let i = 0; i < particleCount; i++) {
      ages[i] += dt;
      const life = lifetimes[i];
      if (ages[i] >= life) {
        // swap with last alive to shrink pool visually
        const last = particleCount - 1;
        if (i !== last) {
          particles[i*3+0] = particles[last*3+0];
          particles[i*3+1] = particles[last*3+1];
          particles[i*3+2] = particles[last*3+2];
          velocities[i*3+0] = velocities[last*3+0];
          velocities[i*3+1] = velocities[last*3+1];
          velocities[i*3+2] = velocities[last*3+2];
          ages[i] = ages[last];
          lifetimes[i] = lifetimes[last];
          opacities[i] = opacities[last];
        }
        particleCount--;
        particleGeom.setDrawRange(0, particleCount);
        i--; // re-evaluate swapped index
        continue;
      }
      // integrate
      velocities[i*3+1] += gravity * (dt); // gravity scaled by dt
      particles[i*3+0] += velocities[i*3+0] * dt * 0.001;
      particles[i*3+1] += velocities[i*3+1] * dt * 0.001;
      particles[i*3+2] += velocities[i*3+2] * dt * 0.001;

      // fade opacity using ease-out
      const t = ages[i] / lifetimes[i];
      opacities[i] = Math.max(0, 1 - (t * t * 1.2)); // faster fade near end
    }
    // update buffers
    particleGeom.attributes.position.needsUpdate = true;
    particleGeom.attributes.aOpacity.needsUpdate = true;
    // update per-point opacity via material alpha (we use single material -> global opacity),
    // but to get per-point alpha we could use custom shader. For simplicity we set material.opacity to 1
    // and rely on color/size/fading to create realistic effect.
    // To simulate per-particle alpha with PointsMaterial we adjust vertex colors; but leaving simple here.
    // We'll apply slight global fade if many particles
    particleMat.opacity = 0.95;
  }

  // Load model
  const loader = new THREE.GLTFLoader();
  let bottle = null;
  let nozzleWorld = new THREE.Vector3(0, 1.0, 0); // fallback
  loader.load('spray-bottle.glb',
    (gltf) => {
      bottle = gltf.scene;
      // standardize scale & rotation if needed
      bottle.traverse((c) => {
        if (c.isMesh) {
          c.castShadow = true;
          c.receiveShadow = true;
          // avoid modifying user's material too much
        }
      });
      bottle.scale.set(1.1, 1.1, 1.1);
      // position to ground nicely
      bottle.position.set(0, -0.25, 0);
      modelGroup.add(bottle);

      // Attempt to detect a nozzle point:
      // We compute bounding box and pick a front-top point as nozzle approximation.
      const box = new THREE.Box3().setFromObject(bottle);
      const size = new THREE.Vector3();
      box.getSize(size);
      const center = new THREE.Vector3();
      box.getCenter(center);
      // approximate nozzle: slightly in front (z - size.z/2) and near top (y + size.y/2 * 0.6)
      nozzleWorld.set(center.x, center.y + size.y * 0.18, center.z - size.z * 0.45);
      bottle.updateWorldMatrix(true, true);
      bottle.localToWorld(nozzleWorld);
    },
    undefined,
    (err) => {
      console.error('GLB load error:', err);
      // fallback: create a simple bottle-like mesh
      const fallback = new THREE.Mesh(
        new THREE.CylinderGeometry(0.18, 0.18, 0.7, 12),
        new THREE.MeshStandardMaterial({ color: 0x88c0ff, roughness: 0.45, metalness: 0.1 })
      );
      fallback.position.set(0, 0.1, 0);
      modelGroup.add(fallback);
      // set nozzle above
      nozzleWorld.set(0, 0.4, -0.15);
    }
  );

  // raycaster for click-to-spray detection
  const raycaster = new THREE.Raycaster();
  const pointer = new THREE.Vector2();

  function getPointerWorld(x, y) {
    const rect = canvas.getBoundingClientRect();
    pointer.x = ((x - rect.left) / rect.width) * 2 - 1;
    pointer.y = - ((y - rect.top) / rect.height) * 2 + 1;
    raycaster.setFromCamera(pointer, camera);
    return raycaster.ray;
  }

  // On click: try to intersect bottle; if hit, use that point and normal as spray origin/direction.
  canvas.addEventListener('pointerdown', (ev) => {
    ev.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const x = ev.clientX;
    const y = ev.clientY;
    const r = getPointerWorld(x, y);
    if (bottle) {
      const intersects = raycaster.intersectObject(bottle, true);
      if (intersects.length > 0) {
        const hit = intersects[0];
        // world-space origin slightly forward from hit point
        const origin = hit.point.clone();
        // approximate nozzle normal by face normal transformed to world
        const normalMatrix = new THREE.Matrix3().getNormalMatrix(hit.object.matrixWorld);
        const worldNormal = hit.face.normal.clone().applyMatrix3(normalMatrix).normalize();
        const dir = worldNormal.clone().multiplyScalar(-1).normalize(); // spray away from nozzle
        emitMist(origin, dir, 120); // stronger burst for realistic mist
        return;
      }
    }
    // fallback: use nozzleWorld & camera forward
    const origin = nozzleWorld.clone();
    const dir = camera.position.clone().sub(origin).normalize().multiplyScalar(-1);
    emitMist(origin, dir, 90);
  });

  // subtle idle rotation if user not dragging
  let lastTime = performance.now();
  let isUserInteracting = false;
  canvas.addEventListener('pointerdown', () => isUserInteracting = true);
  window.addEventListener('pointerup', () => { isUserInteracting = false; });

  // animation loop
  function animate() {
    requestAnimationFrame(animate);
    const now = performance.now();
    const dt = now - lastTime;
    lastTime = now;

    // resize
    resizeRendererToDisplaySize();

    // idle rotation
    if (!isUserInteracting) {
      modelGroup.rotation.y += 0.0007 * dt;
    }

    // update particles
    updateParticles(dt);

    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // initial resize
  setTimeout(resizeRendererToDisplaySize, 100);
  window.addEventListener('resize', resizeRendererToDisplaySize);

  // expose __spray for debugging or UI buttons
  window.__spray = function () {
    const origin = nozzleWorld.clone();
    const dir = camera.position.clone().sub(origin).normalize().multiplyScalar(-1);
    emitMist(origin, dir, 100);
  };
})();
</script>

<!-- Booking / form logic (kept from your original) -->
<script>
  const pricing = {
    "1RK": { "Furnished": 2000, "Non-Furnished": 1500 },
    "1BHK": { "Furnished": 2500, "Non-Furnished": 2000 },
    "2BHK": { "Furnished": 4500, "Non-Furnished": 4000 },
    "3BHK": { "Furnished": 5500, "Non-Furnished": 5000 },
    "4BHK": { "Furnished": 7000, "Non-Furnished": 6000 },
    "5BHK": { "Furnished": 10000, "Non-Furnished": 8500 }
  };

  function calculateTotal() {
    const bhk = document.querySelector('[name="bhk"]').value;
    const furnished = document.querySelector('[name="furnished"]').value;

    let total = pricing[bhk]?.[furnished] || 0;
    const addonsDetails = [];

    document.querySelectorAll('.addon:checked').forEach(addon => {
      const price = parseInt(addon.dataset.price);
      total += price;
      addonsDetails.push(`${addon.value}: ₹${price}`);
    });

    document.getElementById("estimatedPrice").innerText = total;
    document.querySelector('[name="price"]').value = total;
    document.querySelector('[name="addons"]').value = addonsDetails.join(", ");
  }

  window.addEventListener('DOMContentLoaded', calculateTotal);

  document.querySelector('[name="bhk"]').addEventListener("change", calculateTotal);
  document.querySelector('[name="furnished"]').addEventListener("change", calculateTotal);
  document.querySelectorAll('.addon').forEach(el => el.addEventListener("change", calculateTotal));

  document.getElementById("bookingForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = e.target;

    // Show spinner and hide form
    document.getElementById("spinner").style.display = "block";
    form.style.display = "none";

    const data = new FormData(form);

    fetch("https://script.google.com/macros/s/AKfycbxCl4QKzA7cytjsylc821h0DZIATSp4FGD2JQVNDzdOwRK1y8VpvSoxg3Z5g52qp7uA/exec", {
      method: "POST",
      body: new URLSearchParams(data)
    })
    .then(() => {
      window.location.href = "thankyou.html?" + new URLSearchParams(data).toString();
    })
    .catch((err) => {
      alert("Something went wrong. Please try again.");
      console.error("Error submitting form", err);
      form.style.display = "block";
      document.getElementById("spinner").style.display = "none";
    });
  });
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log("✅ Service Worker registered", reg))
        .catch(err => console.error("❌ Service Worker failed", err));
    });
  }
</script>

</body>
</html>
