<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sachin Deep Cleaning</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007bff" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- OneSignal (kept as in your original) -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

  <style>
    :root {
      --bg: #0b0b0d;
      --panel: #0f1720;
      --muted: #a6b0bf;
      --accent: #007bff;
    }
    html,body { height:100%; margin:0; }
    body { font-family: Arial, sans-serif; background: var(--bg); color: white; }

    /* Site header/footer (kept similar to your original) */
    .hero {
      background: url('https://aonedeepcleaning.in/assets/img/cleaning/slide3.jpg') no-repeat center center;
      background-size: cover;
      color: white;
      padding: 90px 0;
      text-align: center;
    }
    footer { background: #071018; color: #9aa6b4; padding: 20px 0; text-align: center; }

    /* 3D Section */
    #threeDSection {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding: 30px 0;
    }
    #threeDWrapper {
      max-width: 1100px;
      margin: 0 auto;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.7);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    }
    canvas { display:block; width:100%; height:500px; }

    /* Controls hint */
    .three-hint {
      position: absolute;
      right: 24px;
      bottom: 24px;
      background: rgba(0,0,0,0.45);
      color: #dbe7ff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      backdrop-filter: blur(4px);
    }

    /* Floating buttons kept from your original */
    .floating-button {
      position: fixed;
      bottom: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
      text-decoration: none;
    }
    .call-button { left: 20px; background-color: var(--accent); }
    .whatsapp-button { right: 20px; bottom: 110px; background-color: #25d366; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <div class="container">
    <a class="navbar-brand" href="#">Sachin Deep Cleaning</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="hero">
  <div class="container">
    <h1>Residential & Commercial Cleaning Services</h1>
    <p>Serving Gurgaon with Professional Cleaning Solutions</p>
    <a href="#booking" class="btn btn-primary mt-3">Book Now</a>
  </div>
</section>

<!-- 3D model section -->
<section id="threeDSection">
  <div id="threeDWrapper" style="position:relative;">
    <canvas id="threeCanvas" aria-label="3D spray bottle preview"></canvas>
    <div class="three-hint">Drag to rotate • Click to spray</div>
  </div>
</section>

<section class="services py-5" id="services">
  <div class="container">
    <div class="text-center mb-4">
      <h2>Our Services</h2>
    </div>
  </div>
</section>

<section class="py-5 bg-light" id="booking">
  <div class="container">
    <div class="text-center mb-4">
      <h2>Book a Cleaning Service</h2>
      <p>Fill out the form below to schedule a cleaning</p>
    </div>
    <form id="bookingForm" class="row g-3">
      <div class="col-md-6">
        <input type="text" name="name" class="form-control" placeholder="Your Name" required>
      </div>
      <div class="col-md-6">
        <input type="tel" name="phone" class="form-control" placeholder="Your Phone Number" required>
      </div>
      <div class="col-md-6">
        <select name="bhk" class="form-select" required>
          <option value="" disabled selected>Select BHK Type</option>
          <option value="1RK">1RK</option>
          <option value="1BHK">1BHK</option>
          <option value="2BHK">2BHK</option>
          <option value="3BHK">3BHK</option>
          <option value="4BHK">4BHK</option>
          <option value="5BHK">5BHK</option>
        </select>
      </div>
      <div class="col-md-6">
        <select name="furnished" class="form-select" required>
          <option value="" disabled selected>Furnishing</option>
          <option value="Furnished">Furnished</option>
          <option value="Non-Furnished">Non-Furnished</option>
        </select>
      </div>

      <!-- Add-ons -->
      <div class="col-12">
        <label class="form-label">Add-on Services (optional)</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Carpet Cleaning" data-price="500">
          <label class="form-check-label">Carpet Cleaning (+₹500)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Fridge Cleaning" data-price="300">
          <label class="form-check-label">Fridge Cleaning (+₹300)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Balcony Cleaning" data-price="400">
          <label class="form-check-label">Balcony Cleaning (+₹400)</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input addon" type="checkbox" value="Pest Control" data-price="600">
          <label class="form-check-label">Pest Control (+₹600)</label>
        </div>
      </div>

      <!-- Display Price -->
      <div class="col-12">
        <h5>Estimated Price: ₹<span id="estimatedPrice">0</span></h5>
      </div>

      <input type="hidden" name="price">
      <input type="hidden" name="addons">
      <input type="hidden" name="payment" value="Pay After Work">

      <div class="col-12 text-center">
        <button type="submit" class="btn btn-primary">Submit Booking</button>
      </div>
    </form>

    <!-- Spinner element -->
    <div id="spinner" style="display:none;"></div>
  </div>
</section>

<footer>
  <div class="container">
    <p>&copy; 2025 Sachin Deep Cleaning. All rights reserved.</p>
  </div>
</footer>

<a href="tel:+919267905943" class="floating-button call-button" title="Call Now">
  <i class="fas fa-phone-alt"></i>
</a>
<a href="https://wa.me/919267905943" class="floating-button whatsapp-button" title="Chat on WhatsApp" target="_blank">
  <i class="fab fa-whatsapp"></i>
</a>

<!-- Bootstrap bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Three.js + extras from CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/*
  3D spray interaction
  - Place spray-bottle.glb next to this HTML (same folder)
  - Click canvas to spray (short particle burst)
  - Drag to orbit
*/

(function () {
  const canvas = document.getElementById('threeCanvas');
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x071018);

  // Renderer
  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  renderer.setSize(canvas.clientWidth || canvas.parentElement.clientWidth, 500, false);

  // Camera
  const camera = new THREE.PerspectiveCamera(45, (canvas.clientWidth || canvas.parentElement.clientWidth) / 500, 0.1, 100);
  camera.position.set(0, 1.4, 3.2);

  // Lights
  const hemi = new THREE.HemisphereLight(0xffffff, 0x111122, 0.8);
  scene.add(hemi);
  const rim = new THREE.DirectionalLight(0xffffff, 0.9);
  rim.position.set(4, 5, 2);
  scene.add(rim);

  // Ground subtle reflection plane (faint)
  const groundMat = new THREE.MeshStandardMaterial({ color: 0x071018, roughness: 0.9, metalness: 0.0 });
  const ground = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = -1.35;
  scene.add(ground);

  // Orbit controls
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.12;
  controls.minDistance = 1.4;
  controls.maxDistance = 6;
  controls.target.set(0, 1.1, 0);

  // small helper group for model
  const modelGroup = new THREE.Group();
  scene.add(modelGroup);

  // Create a small round particle texture via canvas (so there are no external images)
  function createParticleTexture() {
    const size = 64;
    const tx = document.createElement('canvas');
    tx.width = tx.height = size;
    const ctx = tx.getContext('2d');

    const g = ctx.createRadialGradient(size/2, size/2, 2, size/2, size/2, size/2);
    g.addColorStop(0, 'rgba(255,255,255,1)');
    g.addColorStop(0.2, 'rgba(255,255,255,0.9)');
    g.addColorStop(0.5, 'rgba(180,200,255,0.45)');
    g.addColorStop(1, 'rgba(180,200,255,0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,size,size);

    const texture = new THREE.CanvasTexture(tx);
    texture.minFilter = THREE.LinearFilter;
    texture.needsUpdate = true;
    return texture;
  }
  const particleTexture = createParticleTexture();

  // Particle system pool (reusable)
  const particlePool = [];
  const activeParticles = [];

  function spawnParticle(pos, vel, lifetime = 900) {
    let p = particlePool.pop();
    if (!p) {
      const geom = new THREE.BufferGeometry();
      geom.setAttribute('position', new THREE.Float32BufferAttribute([0,0,0], 3));
      const mat = new THREE.PointsMaterial({
        size: 0.06,
        map: particleTexture,
        transparent: true,
        depthWrite: false,
        blending: THREE.AdditiveBlending,
        sizeAttenuation: true,
        opacity: 1.0
      });
      p = { geom, mat, points: new THREE.Points(geom, mat), alive: false };
    }
    p.points.material = p.mat; // ensure material
    p.points.position.copy(pos);
    p.velocity = vel.clone();
    p.birth = performance.now();
    p.lifetime = lifetime;
    p.alive = true;
    scene.add(p.points);
    activeParticles.push(p);
    return p;
  }

  function despawnParticle(p) {
    p.alive = false;
    try { scene.remove(p.points); } catch(e){}
    particlePool.push(p);
  }

  // Simple particle burst generator (spray)
  function sprayBurst(origin, direction, count = 22) {
    for (let i=0;i<count;i++) {
      const spread = 0.15;
      // create velocity with some spread
      const jitter = new THREE.Vector3(
        (Math.random()-0.5)*spread,
        (Math.random()-0.2)*spread,
        (Math.random()-0.5)*spread
      );
      const v = direction.clone().multiplyScalar(3 + Math.random()*1.8).add(jitter);
      const start = origin.clone().add(direction.clone().multiplyScalar(0.35)).add(new THREE.Vector3(
        (Math.random()-0.5)*0.02,
        (Math.random()-0.5)*0.02,
        (Math.random()-0.5)*0.02
      ));
      spawnParticle(start, v, 700 + Math.random()*500);
    }
  }

  // Load GLB model (spray bottle)
  const loader = new THREE.GLTFLoader();
  const modelUrl = 'spray-bottle.glb'; // <-- place your .glb file here (same folder)
  let bottle = null;
  loader.load(modelUrl,
    (gltf) => {
      bottle = gltf.scene;
      // Normalize scale and orientation a bit (adjust as needed)
      bottle.traverse((c) => {
        if (c.isMesh) {
          c.castShadow = true;
          c.receiveShadow = true;
          c.material.side = THREE.DoubleSide;
        }
      });
      bottle.scale.set(1.2,1.2,1.2);
      bottle.position.set(0, 0.0, 0);
      modelGroup.add(bottle);
    },
    (xhr) => {
      // optional progress
      // console.log((xhr.loaded / xhr.total * 100) + '% loaded');
    },
    (err) => {
      console.error('Failed to load model:', err);
      // If model fails, create a fallback simple object so UI remains useful
      const fallback = new THREE.Mesh(
        new THREE.CapsuleGeometry(0.25, 0.8, 6, 12),
        new THREE.MeshStandardMaterial({ color: 0x88c0ff, metalness: 0.25, roughness: 0.45 })
      );
      fallback.position.set(0, 0, 0);
      modelGroup.add(fallback);
    }
  );

  // Raycaster for clicks
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  // Compute world-space spray origin and direction when clicking canvas
  function handlePointer(x, y) {
    const rect = canvas.getBoundingClientRect();
    mouse.x = ((x - rect.left) / rect.width) * 2 - 1;
    mouse.y = - ((y - rect.top) / rect.height) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);

    // If bottle exists, try to get a hit point near bottle; else spray from camera forward
    if (bottle) {
      // Intersect bottle
      const intersects = raycaster.intersectObject(bottle, true);
      if (intersects.length > 0) {
        const pt = intersects[0].point;
        // direction from bottle toward camera (spray away from bottle nozzle approximated by normal)
        const dir = intersects[0].face ? intersects[0].face.normal.clone().transformDirection(bottle.matrixWorld) : camera.position.clone().sub(pt).normalize();
        // Invert dir so spray goes away from nozzle towards screen
        dir.normalize().multiplyScalar(-1);
        sprayBurst(pt, dir, 28);
        return;
      }
    }
    // fallback: spray forward from camera position
    const origin = camera.position.clone();
    const dir = raycaster.ray.direction.clone();
    sprayBurst(origin, dir, 22);
  }

  // pointer events
  let isTouch = false;
  canvas.addEventListener('pointerdown', (ev) => {
    isTouch = ev.pointerType === 'touch' || ev.pointerType === 'pen';
    handlePointer(ev.clientX, ev.clientY);
  });

  // Small idle rotation for model
  let last = performance.now();
  function animate() {
    const now = performance.now();
    const dt = now - last;
    last = now;

    // update particles
    for (let i = activeParticles.length - 1; i >= 0; i--) {
      const p = activeParticles[i];
      if (!p || !p.alive) { activeParticles.splice(i,1); continue; }
      const age = now - p.birth;
      if (age >= p.lifetime) {
        // remove
        despawnParticle(p);
        activeParticles.splice(i,1);
        continue;
      }
      // simple physics: velocity damping + gravity
      p.velocity.y -= 0.006 * (dt/16); // gravity-ish
      p.points.position.addScaledVector(p.velocity, dt/1000);
      // fade opacity with age
      const t = age / p.lifetime;
      p.points.material.opacity = 1 - t;
      // scale down a bit over lifetime
      p.points.material.size = 0.06 * (1 - 0.6 * t);
      // also slightly rotate camera target for subtle dynamism
    }

    // Idle rotate model group slowly if user not interacting
    modelGroup.rotation.y += 0.0009 * dt;

    controls.update();
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  // resize
  function onResize() {
    const parentWidth = canvas.parentElement.clientWidth;
    const height = 500;
    renderer.setSize(parentWidth, height, false);
    camera.aspect = parentWidth / height;
    camera.updateProjectionMatrix();
  }
  window.addEventListener('resize', onResize, { passive: true });
  onResize();

  // Keep pointer cursor hint
  canvas.style.cursor = 'pointer';

  // Expose a small helper to programmatically trigger spray (can be used if you add UI buttons)
  window.__spray = function () {
    // spray from bottle frontal direction
    if (!bottle) return;
    const origin = bottle.getWorldPosition(new THREE.Vector3());
    const forward = new THREE.Vector3(0, 0, -1).applyQuaternion(bottle.getWorldQuaternion(new THREE.Quaternion())).normalize();
    sprayBurst(origin.add(forward.multiplyScalar(0.25)), forward, 26);
  };

})();
</script>

<!-- Booking / form logic (kept from your original) -->
<script>
  const pricing = {
    "1RK": { "Furnished": 2000, "Non-Furnished": 1500 },
    "1BHK": { "Furnished": 2500, "Non-Furnished": 2000 },
    "2BHK": { "Furnished": 4500, "Non-Furnished": 4000 },
    "3BHK": { "Furnished": 5500, "Non-Furnished": 5000 },
    "4BHK": { "Furnished": 7000, "Non-Furnished": 6000 },
    "5BHK": { "Furnished": 10000, "Non-Furnished": 8500 }
  };

  function calculateTotal() {
    const bhk = document.querySelector('[name="bhk"]').value;
    const furnished = document.querySelector('[name="furnished"]').value;

    let total = pricing[bhk]?.[furnished] || 0;
    const addonsDetails = [];

    document.querySelectorAll('.addon:checked').forEach(addon => {
      const price = parseInt(addon.dataset.price);
      total += price;
      addonsDetails.push(`${addon.value}: ₹${price}`);
    });

    document.getElementById("estimatedPrice").innerText = total;
    document.querySelector('[name="price"]').value = total;
    document.querySelector('[name="addons"]').value = addonsDetails.join(", ");
  }

  window.addEventListener('DOMContentLoaded', calculateTotal);

  document.querySelector('[name="bhk"]').addEventListener("change", calculateTotal);
  document.querySelector('[name="furnished"]').addEventListener("change", calculateTotal);
  document.querySelectorAll('.addon').forEach(el => el.addEventListener("change", calculateTotal));

  document.getElementById("bookingForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = e.target;

    // Show spinner and hide form
    document.getElementById("spinner").style.display = "block";
    form.style.display = "none";

    const data = new FormData(form);

    fetch("https://script.google.com/macros/s/AKfycbxCl4QKzA7cytjsylc821h0DZIATSp4FGD2JQVNDzdOwRK1y8VpvSoxg3Z5g52qp7uA/exec", {
      method: "POST",
      body: new URLSearchParams(data)
    })
    .then(() => {
      window.location.href = "thankyou.html?" + new URLSearchParams(data).toString();
    })
    .catch((err) => {
      alert("Something went wrong. Please try again.");
      console.error("Error submitting form", err);
      form.style.display = "block";
      document.getElementById("spinner").style.display = "none";
    });
  });
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log("✅ Service Worker registered", reg))
        .catch(err => console.error("❌ Service Worker failed", err));
    });
  }
</script>

</body>
</html>
